#!/usr/bin/env python
# coding: utf-8

# In[1]:


import requests
import json


# In[2]:


api_key = '<api>'


# In[ ]:


hashes_url = 'https://virusshare.com/hashfiles/VirusShare_00360.md5'
hashes = requests.get(hashes_url).text


# In[10]:


hash_list = str(hashes).split('\\n')
hash_list = hash_list[6:]


# In[11]:


from random import sample
from random import seed

seed(42)
hash_list = sample(hash_list,2000)


# In[ ]:


for h in hash_list:
    report_url = 'https://virusshare.com/apiv2/file?apikey=%s&hash=%s' % (api_key, h)
    try:
        report = json.loads(requests.get(report_url).content)
    except Exception:
        continue
    if report['virustotal']['positives'] > 30:
        dwnld_url = 'https://virusshare.com/apiv2/download?apikey=%s&hash=%s' % (api_key, h)
        with open('new_virusshare_samples/archieves/%s.zip' % h, 'wb') as f:
            f.write(requests.get(dwnld_url).content)


# In[21]:


from zipfile import ZipFile


# In[22]:


import os


# In[25]:


prefix = '/root/virusshare_valid_data/'
mal_list = os.listdir(prefix)


# In[29]:


for mal in mal_list:
    with ZipFile(prefix+mal) as z:
        z.extractall(path='/root/vv_RGB/', pwd=b'infected')


# In[ ]:




